jQuery(function(){var u=$("#filmTasteForm"),E=$("#btn_submit"),F=$("#btn_suggested"),C=$("#films-result"),D=$("#filmsInputs"),B="http://labs.guoshuang.com/films/";D.find(".addMore").on("click",function(){$(this).before('<li><div class="tipsDiv"><ul></ul></div><input autocomplete="off" /></li>')}),D.on("click",".tipsDiv li",function(){var u=$(this).parent().parent(),E=u.parent().find("input");return E.val($(this).text()),u.hide(),!1}),$(document).on("click",function(){$(".tipsDiv").hide()}),D.on("keyup","input",function(){var u=$(this);return $.trim(u.val()).length<1?!1:($.ajax({url:B+"movietips.php",async:!1,data:{moviename:$(this).val()},dataType:"jsonp",beforeSend:function(){var E=u.parents("li").find(".tipsDiv");E.find("li").remove(),E.hide()},success:function(E){if(""!=E.str){var F=E.str.split(",");console.log(F);var C=u.parent().find(".tipsDiv");console.log(C);var D="";$.each(F,function(u,E){D+="<li>"+E+"</li>"}),C.find(">ul").html(D),C.show()}}}),void 0)}),E.on("click",function(){var E=[];D.find("input").each(function(u,F){E.push(""+$(F).val())}),console.log("我提交的电影",E),$.ajax({url:B+"add.php",async:!1,data:{username:u.find("[name=username]").val(),"film[]":E},dataType:"jsonp",beforeSend:function(){C.html('<p id="loading"><i class="icon icon-spin" style="width: 32px;height: 32px;display:inline-block;"></i> 处理中，稍后！</p>')},complete:function(){$("#loading").remove()},success:function(u){console.log("注册用户并提交电影：",u),"true"==u.success&&C.append("<p>"+u.info+"</p>"),$("#films-result,#films-result-h3").show()}})}),F.on("click",function(){$.ajax({url:B+"recommend.php",data:{username:u.find("[name=username]").val()},dataType:"jsonp",beforeSend:function(){C.html('<p id="loading"><i class="icon icon-spin" style="width: 32px;height: 32px;display:inline-block;"></i> 处理中，稍后！</p>')},complete:function(){$("#loading").remove()},success:function(u){if(console.log("查询推荐：",u),"false"==u.success)C.text(u.info);else{var E="<dl>";$.each(u.items,function(u,F){E+="<dt>"+F.name+"</dt><dd> 推荐次数："+F.count+"</dd>"}),E+='</dl><div class="clearfix"></div>',C.append(E)}$("#films-result,#films-result-h3").show()}})});var A=$("#films-list");$("#viewAllData-btn").on("click",function(){$.ajax({url:B+"list.php",dataType:"jsonp",success:function(u){var E="<ul>";$.each(u.items,function(u,F){E+='<li data-id="'+F.id+'">'+F.name+" 喜欢 "+F.film+"</li>"}),E+="<ul>",A.append(E)}})})});