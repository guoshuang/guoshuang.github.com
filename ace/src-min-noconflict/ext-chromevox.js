ace.define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(e){function t(){return"undefined"!=typeof cvox&&cvox&&cvox.Api}function i(e){if(t())Ft(e);else{if(mt++,mt>=ft)return;window.setTimeout(i,500,e)}}var n={};n.SpeechProperty,n.Cursor,n.Token,n.Annotation;var r={rate:.8,pitch:.4,volume:.9},o={rate:1,pitch:.5,volume:.9},s={rate:.8,pitch:.8,volume:.9},u={rate:.8,pitch:.3,volume:.9},a={rate:.8,pitch:.7,volume:.9},l={rate:.8,pitch:.8,volume:.9},c={punctuationEcho:"none",relativePitch:-.6},h="ALERT_NONMODAL",d="ALERT_MODAL",g="INVALID_KEYPRESS",E="insertMode",F="start",m=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],f={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"},C="CONTROL + SHIFT ";n.editor=null;var p=null,A={},B=!1,D=!1,v=!1,w=null,b={},y={},_=function(e){return C+String.fromCharCode(e)},$=function(){var e=n.editor.keyBinding.getKeyboardHandler();return"ace/keyboard/vim"===e.$id},k=function(e){return n.editor.getSession().getTokenAt(e.row,e.column+1)},x=function(e){return n.editor.getSession().getLine(e.row)},S=function(e){A[e.row]&&cvox.Api.playEarcon(h),B?(cvox.Api.stop(),j(e),N(k(e)),W(e.row,1)):W(e.row,0)},L=function(e){var t=x(e),i=t.substr(e.column-1);0===e.column&&(i=" "+t);var n=/^\W(\w+)/,r=n.exec(i);return null!==r},R={constant:{prop:r},entity:{prop:s},keyword:{prop:u},storage:{prop:a},variable:{prop:l},meta:{prop:o,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},M={prop:M},T=function(e,t){for(var i=e,n=0;n<t.length;n++){var r=t[n],o=new RegExp(r.substr,"g");i=i.replace(o,r.newSubstr)}return i},O=function(e,t,i){var n={};n.value="",n.type=e[t].type;for(var r=t;i>r;r++)n.value+=e[r].value;return n},I=function(e){if(e.length<=1)return e;for(var t=[],i=0,n=1;n<e.length;n++){var r=e[i],o=e[n];z(r)!==z(o)&&(t.push(O(e,i,n)),i=n)}return t.push(O(e,i,e.length)),t},P=function(e){var t=n.editor.getSession().getLine(e),i=/^\s*$/;return null!==i.exec(t)},W=function(e,t){var i=n.editor.getSession().getTokens(e);if(0===i.length||P(e))return cvox.Api.playEarcon("EDITABLE_TEXT"),void 0;i=I(i);var r=i[0];i=i.filter(function(e){return e!==r}),H(r,t),i.forEach(N)},N=function(e){H(e,1)},z=function(e){if(e&&e.type){var t=e.type.split(".");if(0!==t.length){var i=t[0],n=R[i];return n?n:M}}},H=function(e,t){var i=z(e),n=T(e.value,m);i.replace&&(n=T(n,i.replace)),cvox.Api.speak(n,t,i.prop)},j=function(e){var t=x(e);cvox.Api.speak(t[e.column],1)},G=function(e,t){var i=x(t),n=i.substring(e.column,t.column);n=n.replace(/ /g," space "),cvox.Api.speak(n)},U=function(e,t){if(1!==Math.abs(e.column-t.column)){var i=x(t).length;if(0===t.column||t.column===i)return W(t.row,0),void 0;if(L(t))return cvox.Api.stop(),N(k(t)),void 0}j(t)},V=function(e,t){n.editor.selection.isEmpty()?D?G(e,t):U(e,t):(G(e,t),cvox.Api.speak("selected",1))},K=function(){if(v)return v=!1,void 0;var e=n.editor.selection.getCursor();e.row!==p.row?S(e):V(p,e),p=e},Y=function(){n.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},Q=function(e){var t=e.data;switch(t.action){case"removeText":cvox.Api.speak(t.text,0,c),v=!0;break;case"insertText":cvox.Api.speak(t.text,0),v=!0}},Z=function(e){var t=e.row,i=e.column;return!A[t]||!A[t][i]},q=function(e){A={};for(var t=0;t<e.length;t++){var i=e[t],n=i.row,r=i.column;A[n]||(A[n]={}),A[n][r]=i}},X=function(){var e=n.editor.getSession().getAnnotations(),t=e.filter(Z);t.length>0&&cvox.Api.playEarcon(h),q(e)},J=function(e){var t=e.type+" "+e.text+" on "+tt(e.row,e.column);t=t.replace(";","semicolon"),cvox.Api.speak(t,1)},et=function(e){var t=A[e];for(var i in t)J(t[i])},tt=function(e,t){return"row "+(e+1)+" column "+(t+1)},it=function(){cvox.Api.speak(tt(p.row,p.column))},nt=function(){for(var e in A)et(e)},rt=function(){if($())switch(n.editor.keyBinding.$data.state){case E:cvox.Api.speak("Insert mode");break;case F:cvox.Api.speak("Command mode")}},ot=function(){B=!B,B?cvox.Api.speak("Speak location on row change enabled."):cvox.Api.speak("Speak location on row change disabled.")},st=function(){D=!D,D?cvox.Api.speak("Speak displacement on column changes."):cvox.Api.speak("Speak current character or word on column changes.")},ut=function(e){if(e.ctrlKey&&e.shiftKey){var t=b[e.keyCode];t&&t.func()}},at=function(e,t){if($()){var i=t.keyBinding.$data.state;if(i!==w){switch(i){case E:cvox.Api.playEarcon(d),cvox.Api.setKeyEcho(!0);break;case F:cvox.Api.playEarcon(d),cvox.Api.setKeyEcho(!1)}w=i}}},lt=function(e){var t=e.detail.customCommand,i=y[t];i&&(i.func(),n.editor.focus())},ct=function(){var e=gt.map(function(e){return{desc:e.desc+_(e.keyCode),cmd:e.cmd}}),t=document.querySelector("body");t.setAttribute("contextMenuActions",JSON.stringify(e)),t.addEventListener("ATCustomEvent",lt,!0)},ht=function(e){e.match?W(p.row,0):cvox.Api.playEarcon(g)},dt=function(){n.editor.focus()},gt=[{keyCode:49,func:function(){et(p.row)},cmd:f.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:nt,cmd:f.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:rt,cmd:f.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:ot,cmd:f.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:it,cmd:f.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:st,cmd:f.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:dt,cmd:f.FOCUS_TEXT,desc:"Focus text"}],Et=function(){n.editor=editor,editor.getSession().selection.on("changeCursor",K),editor.getSession().selection.on("changeSelection",Y),editor.getSession().on("change",Q),editor.getSession().on("changeAnnotation",X),editor.on("changeStatus",at),editor.on("findSearchBox",ht),editor.container.addEventListener("keydown",ut),p=editor.selection.getCursor()},Ft=function(e){Et(),gt.forEach(function(e){b[e.keyCode]=e,y[e.cmd]=e}),e.on("focus",Et),$()&&cvox.Api.setKeyEcho(!1),ct()},mt=0,ft=15,Ct=e("../editor").Editor;e("../config").defineOptions(Ct.prototype,"editor",{enableChromevoxEnhancements:{set:function(e){e&&i(this)},value:!0}})});